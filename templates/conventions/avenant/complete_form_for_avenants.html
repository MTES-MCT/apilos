{% load custom_filters %}

<div>
    <p class="fr-alert__title">Valider l'avenant</p>
    <p class="fr-mb-0">
        avenant : {{convention.uuid}} - 
        ville : {{convention.programme.ville}} - nb logements : {{convention.lot.nb_logements}} <br/>
        parent : {{convention.parent.uuid}} - 
        ville : {{convention.parent.programme.ville}} - nb logements : {{convention.parent.lot.nb_logements}} - fichier : {{convention.parent.nom_fichier_signe}}
        {% if not convention.parent.programme.ville or not convention.parent.lot.nb_logements or not convention.parent.nom_fichier_signe %}
            Pour pouvoir valider cet avenant, vous devez remplir les informations suivantes concernant la convention originale.
            <form method="post"  action="{% url 'conventions:validate' convention_uuid=convention.uuid %}" data-turbo="false">
                {% csrf_token %}
                <input id="completeform" type="hidden" name="completeform" value="true">
                {% if not convention.parent.programme.ville %}
                    <div class="fr-col-12 fr-col-md-6">
                        pas de ville
                        {% include "common/form/input_text.html" with form_input=complete_for_avenant_form.ville editable=True %}
                    </div>
                {% endif %}
                {% if not convention.parent.lot.nb_logements %}
                    <div class="fr-col-12 fr-col-md-6">
                        - pas de logements
                        {% include "common/form/input_number.html" with form_input=complete_for_avenant_form.nb_logements editable=True %}
                    </div>
                {% endif %}
                {% if not convention.parent.nom_fichier_signe %}
                - pas de fichier
                <div class="fr-upload-group fr-my-5w">
                    <label class="fr-label" for="file-upload">Téléverser la convention (en PDF)
                        <span class="fr-hint-text">Taille maximale : 500 Mo. Formats supportés : pdf</span>
                    </label>
                    <input class="fr-upload" type="file" id="file-upload" name="nom_fichier_signe">
                </div>
                {% endif %}
                <button>Envoyer</button>
            </form>
        {% else %}
            {% if convention.numero %}
                <p class="fr-mb-0">L'avenant aura le numéro {{ convention.numero }}</p>
            {% else %}
                <div class="fr-col-md-12 block--row-strech">
                    <div class="block--row-strech-1 fr-mr-6w">
                        <p class="fr-alert__title">Valider l'avenant</p>
                        <p class="fr-mb-0">L'avenant aura le numéro {{conventionNumberForm.convention_numero.value}}.</p>
                    </div>
                    <form method="post" action="{% url 'conventions:validate' convention_uuid=convention.uuid %}" data-turbo="false">
                        {% csrf_token %}
                        <input type="hidden"
                            id="{{conventionNumberForm.convention_numero.id_for_label}}"
                            name="{{conventionNumberForm.convention_numero.html_name}}"
                            value="{{conventionNumberForm.convention_numero.value}}">
                        <button class="fr-btn fr-btn--secondary">
                            Valider l'avenant
                        </button>
                    </form>
                </div>
            {% endif %}
        {% endif %}
    </p>
</div>




    
