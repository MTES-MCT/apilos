{% extends "layout/base.html" %}

{% block page_title %}
    {% if convention.statut == '5. Transmise' %}Actions{% else %}Téléversement{% endif %} - APiLos
{% endblock%}

{% load static %}

{% block content %}
    <div class="fr-container-fluid ds_banner">
        {% include "conventions/common/form_header.html" with convention=convention %}
        {% include "common/step_progressbar.html" with convention=convention %}
        <div class="fr-container fr-pb-5w">
            <h2>Votre convention signée</h2>
            {% if convention.statut == '5. Transmise' %}
                <div class="fr-col-md-12 fr-py-3w">Votre convention signée à déjà été téléversée.</div>
                <div class="fr-col-md-12 fr-pt-2w">Prochainement, vous pourrez :
                    <ul>
                        <li>créer des avenants</li>
                        <li>éditer une fiche CAF</li>
                        <li>résilier la convention</li>
                    </ul>
                </div>
                <div class="fr-col-12 fr-col-lg-6">
                    <div role="alert" class="fr-alert fr-alert--warning">
                        <p class="fr-alert__title">
                            Résiliation/dénonciation de la convention
                        </p>
                        <p>Vous pouvez ici procéder à la résiliation/dénonciation de la convention dans APiLos.</p>
                        <form method="post" action="" id="{{resiliation_form.date_resiliation.id_for_label}}_validation_form" data-turbo="false">
                            {% csrf_token %}
                            <p class="fr-mt-2w"><strong>Spécifier la date de résiliation/dénonciation</strong></p>
                            <div class="fr-grid-row fr-grid-row--gutters">
                                <div class="fr-col-12">
                                    <div class="fr-mt-1w block--row-strech" id="{{resiliation_form.date_resiliation.id_for_label}}_div">
                                        <div class="fr-input fr-input-wrap fr-fi-calendar-line block--row-strech-1">
                                            <input
                                                type="date"
                                                class="dateinput"
                                                id="{{resiliation_form.date_resiliation.id_for_label}}"
                                                name="{{resiliation_form.date_resiliation.html_name}}">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <button class="fr-btn apilos-btn--red fr-btn--icon-left fr-fi-delete-line fr-my-2w" id="{{resiliation_form.date_resiliation.id_for_label}}_validation_button">
                                Résilier/Dénoncer la convention
                            </button>
                            {% for error in resiliation_form.date_resiliation.errors %}
                                <p id="text-input-error-desc-error" class="fr-error-text">
                                    {{ error }}
                                </p>
                            {% endfor %}
                        </form>
                    </div>
                </div>
                <div class="fr-accordion fr-mt-5w">
                    <div class="fr-accordion__title">
                        <div class="fr-accordion__btn clickable " aria-expanded="false" aria-controls="accordion-106"><i>Si nécessaire, vous pouvez téléverser une nouvelle version de la convention signée ici.</i></div>
                    </div>
                    <div class="fr-collapse" id="accordion-106">
            {% else %}
                <div class="fr-col-md-12">Ici, vous pouvez téléverser votre convention signée afin  qu'elle puisse être transmise. </div>
                <div class="fr-py-3w">
            {% endif %}

            <form method="post" action="" enctype="multipart/form-data" id="{{upform.file.id_for_label}}_form">
                {% csrf_token %}
                <input
                    class="fileinput--hidden"
                    type="file"
                    id="{{upform.file.id_for_label}}"
                    name="{{upform.file.html_name}}"
                    accept="application/pdf">
                <div class="block--row-strech">
                    <div>
                        <button id="{{upform.file.id_for_label}}_upload_button" class="fr-btn fr-icon-upload-line fr-btn--icon-left" type="button">
                            Téléverser la convention signée
                        </button>
                        {% for error in upform.file.errors %}
                            <p id="text-input-error-desc-error" class="fr-error-text">
                                {{ error }}
                            </p>
                        {% endfor %}
                    </div>
                </div>

                <script type="text/javascript" nonce="{{request.csp_nonce}}">
                    document.getElementById('{{upform.file.id_for_label}}_upload_button').onclick = function() {
                        document.getElementById('{{upform.file.id_for_label}}').click();
                    };
                    document.getElementById('{{upform.file.id_for_label}}').onchange = function() {
                        var input = document.createElement('input');
                        input.setAttribute('name', 'Upload');//set the param name
                        input.setAttribute('value', 'True');//set the value
                        this.form.appendChild(input)
                        document.getElementById("{{upform.file.id_for_label}}_form").submit();
                    }
                </script>
            </form>
        </div>
        {% if convention.statut == '5. Transmise' %}
            </div>
        {% endif %}
    </div>
{% endblock %}
