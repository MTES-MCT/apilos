<script type="text/javascript" nonce="{{ request.csp_nonce }}">
    document.addEventListener('DOMContentLoaded', function () {
        const statusElement = document.getElementById('convention_redirect_{{ convention.uuid }}');
        const linkElement = document.getElementById('convention_link_{{ convention.uuid }}');

        if (statusElement && linkElement) {
            let targetUrl = "{% url 'conventions:recapitulatif' convention_uuid=convention.uuid %}";

            if (statusElement.classList.contains("sent")) {
                targetUrl = "{% url 'conventions:sent' convention_uuid=convention.uuid %}";
            }
            else if (statusElement.classList.contains("signed")) {
                targetUrl = "{% url 'conventions:post_action' convention_uuid=convention.uuid %}";
            }
            else if (statusElement.classList.contains("project")) {
                targetUrl = "{% url 'conventions:bailleur' convention_uuid=convention.uuid %}";
            }
            else if (statusElement.classList.contains("publication_en_cours")) {
                targetUrl = "{% url 'conventions:publication' convention_uuid=convention.uuid %}";
            }
            else if (statusElement.classList.contains("publie")) {
                targetUrl = "{% url 'conventions:post_action' convention_uuid=convention.uuid %}";
            }

            // Mettre à jour l'URL du lien
            linkElement.href = targetUrl;

            // Gérer le clic sur la ligne (en évitant les checkboxes)
            statusElement.addEventListener('click', function(e) {
                // Ne pas rediriger si on clique sur une checkbox ou un élément avec la classe stop-row-click
                if (e.target.closest('.stop-row-click')) {
                    return;
                }
                location.href = targetUrl;
            });
        }
    });
</script>
