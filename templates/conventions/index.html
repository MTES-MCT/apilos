{% extends "layout/base.html" %}

{% load static %}

{% load custom_filters %}

{% block page_title %}Conventions - APiLos{% endblock%}

{% block content %}

    {% if conventions.total_conventions > 0 %}

        <div class="fr-container-fluid ds_banner">
            <div class="fr-container">
                <div class="fr-grid-row fr-mt-2w fr-grid-row--gutters">
                    <div class="fr-col-12 fr-my-3w block--row-strech fr-grid-row--middle">
                        {% if request|is_bailleur %}
                            <div class="block--row-strech-1">
                                <h1 class="m-0">Conventions et avenants</h1>
                            </div>
                            {% if not CERBERE_AUTH %}
                                <div>
                                    <a class="fr-btn" href="{% url 'conventions:selection' %}">
                                        <span class="fr-fi-add-line fr-mr-1w" aria-hidden="true"></span>Créer une nouvelle convention
                                    </a>
                                    <a class="fr-btn fr-btn--secondary" href="{% url 'conventions:selection' %}">
                                        <span class="fr-fi-add-line fr-mr-1w" aria-hidden="true"></span>Créer un avenant
                                    </a>
                                </div>
                            {% endif %}
                        {% elif request|is_instructeur or request.user.is_superuser %}
                            <div class="block--row-strech-1">
                                <h2 class="fr-mb-3w">Bienvenue dans votre espace Instructeur</h2>
                                <p class="apilos-subtitle">{{conventions.total_conventions}} convention{{ conventions.total_conventions|pluralize }} liée{{ conventions.total_conventions|pluralize }} à votre administration trouvée{{ conventions.total_conventions|pluralize }} dans APiLos</p>
                            </div>
                        {% else %}
                            <p class="fr-mb-3w">Votre profil n'est pas bien configuré, merci de vous rapprocher de votre instructeur</p>
                        {% endif %}
                    </div>
                </div>
                <div class="fr-col-12 fr-grid-row fr-my-1w block--row-strech fr-grid-row--middle">
                    <div class="px-2 text-title-{% if category == 'en-cours' %}-grey{% else %}blue-france{% endif %}">
                        {% if category == 'en-cours' %}<p class="m-0">{% else %}<a class="fr-link apilos-link" href="{% url 'conventions:search' category="en-cours" %}" title="Conventions en cours">{% endif %}
                            <span class="fr-text--bold">58 conventions</span>&nbsp;en cours
                        {% if category == 'en-cours' %}</p>{% else %}</a>{% endif %}
                    </div>
                    <div class="px-2 text-title-{% if category == 'finalisees' %}-grey{% else %}blue-france{% endif %}">
                        {% if category == 'finalisees' %}<p class="m-0">{% else %}<a class="fr-link apilos-link" href="{% url 'conventions:search' category="finalisees" %}" title="Conventions finalisées">{% endif %}
                            <span class="fr-text--bold">256 conventions</span>&nbsp;finalisées
                        {% if category == 'finalisees' %}</p>{% else %}</a>{% endif %}
                    </div>
                </div>
            </div>
        </div>

        {% include "conventions/convention_list.html" %}

        {% if not CERBERE_AUTH %}
            <div class="fr-container-fluid">
                <div class="fr-container">
                    <div class="fr-grid-row fr-grid-row--gutters fr-grid-row--center">
                        <div class="fr-my-5w">
                            <a class="fr-btn" href="{% url 'conventions:selection' %}">
                                <span class="fr-fi-add-circle-line fr-mr-1w" aria-hidden="true"></span>
                                {% if request|is_instructeur %}
                                    Créer une nouvelle convention comme un bailleur
                                {% else %}
                                    Créer une nouvelle convention
                                {% endif %}
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}

    {% else %}
        {% if request|is_bailleur %}
            {% if CERBERE_AUTH %}
                {% include "conventions/home/bailleur_cerbere_no_convention.html" %}
            {% else %}
                {% include "conventions/home/bailleur_no_convention.html" %}
            {% endif %}
        {% elif  request|is_instructeur %}
            {% if CERBERE_AUTH %}
                {% include "conventions/home/instructeur_cerbere_no_convention.html" %}
            {% else %}
                {% include "conventions/home/instructeur_no_convention.html" %}
            {% endif %}
        {% else %}
            {% include "conventions/home/no_profile.html" %}
        {% endif %}
    {% endif %}

{% endblock %}
