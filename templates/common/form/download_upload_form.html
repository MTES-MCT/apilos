{% load static %}

<p>Télécharger le modèle, éditer puis téléverser vos {{ what }}.<br>
    <span class="fr-icon-warning-line fr-mr-1w" aria-hidden="true"></span>Attention, la liste des {{ what }} téléversée écrase la liste courante.
</p>
{% if file_type == "logements_edd" %}
    <p class="fr-mt-1w"><em>Depuis le 1er juin 2022, un nouveau format de fichier est entré en vigueur. La colonne "type des logements" a été remplacée par "numéro de lot". Vous pouvez mettre à jour votre fichier en téléchargeant le nouveau modèle puis en le téléversant à nouveau.</em></p>
{% endif %}

<input
    class="fileinput--hidden"
    type="file"
    id="{{upform.file.id_for_label}}"
    name="{{upform.file.html_name}}"
    accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet">
<div class="block--row-strech">
    <button type="button" class="fr-btn fr-btn--secondary fr-icon-download-line fr-btn--icon-left" id='download_model'>
        Télécharger le modèle des {{ what }}
    </button>
    <script type="text/javascript" nonce="{{request.csp_nonce}}">
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('download_model')
                .addEventListener('click', function(){ location.href="{% url 'conventions:load_xlsx_model' file_type=file_type %}" });
        });
    </script>

    <div class="fr-mx-2w">Puis</div>

    <div>
        <button id="{{upform.file.id_for_label}}_upload_button" class="fr-btn fr-icon-upload-line fr-btn--icon-left" type="button">
            Téléverser le fichier de vos {{ what }}
        </button>
        {% for error in upform.file.errors %}
            <p id="text-input-error-desc-error" class="fr-error-text">
                {{ error }}
            </p>
        {% endfor %}
    </div>

</div>

<script type="text/javascript" nonce="{{request.csp_nonce}}">
    document.getElementById('{{upform.file.id_for_label}}_upload_button').onclick = function() {
        document.getElementById('{{upform.file.id_for_label}}').click();
    };
    document.getElementById('{{upform.file.id_for_label}}').onchange = function() {
        var input = document.createElement('input');
        input.setAttribute('name', 'Upload');//set the param name
        input.setAttribute('value', 'True');//set the value
        this.form.appendChild(input)
        this.form.submit()
    }
</script>
